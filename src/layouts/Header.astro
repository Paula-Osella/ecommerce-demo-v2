---
import "../styles/global.css";

// Importar productos desde el JSON
import productosData from "../data/products.json";

interface Props {
  title?: string;
}

const { title = "header" } = Astro.props;
const currentPath = Astro.url.pathname;

// Función helper para verificar si está activo
const isActive = (path: string) => {
  if (path === '/') return currentPath === '/';
  return currentPath.startsWith(path);
};
---

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="/Logo/Logo2.png">
    <title>{title}</title>
  </head>

  <body class="min-h-screen bg-[#fdf8f6] text-zinc-900 flex flex-col">

    {/* BLOQUE SUPERIOR FIJO */}
    <div class="sticky top-0 z-50">

      {/* Barra superior: contacto + redes sociales */}
      <div class="w-full bg-zinc-900 text-zinc-100 text-[10px] sm:text-[11px] md:text-xs">
        <div class="max-w-7xl mx-auto px-3 sm:px-4 md:px-6 py-1.5 sm:py-2 flex items-center justify-between gap-2 sm:gap-3">

          {/* Texto contacto */}
          <a
            href="#contacto"
            class="uppercase tracking-[0.12em] sm:tracking-[0.18em] font-medium hover:text-pink-200 transition-colors"
          >
            Contactanos
          </a>

          {/* Iconos redes */}
          <div class="flex items-center gap-1.5 sm:gap-2">

            {/* WhatsApp */}
            <a
              href="https://wa.me/5491112345678"
              target="_blank"
              rel="noopener noreferrer"
              aria-label="WhatsApp"
              class="w-5 h-5 sm:w-6 sm:h-6 rounded-full border border-zinc-500 flex items-center justify-center hover:bg-white hover:text-zinc-900 transition-colors"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                <path d="M5 19l1-3.5A7 7 0 1 1 19 11a7 7 0 0 1-10.5 6L5 19z" />
                <path d="M10 9.5c0 .6.3 1.1.7 1.6.3.4.7.7 1.1 1 .4.2.8.4 1.2.4.3 0 .5-.1.7-.3l.4-.4" />
              </svg>
            </a>

            {/* Instagram */}
            <a
              href="https://www.instagram.com/alvitcs?igsh=eHRjcnM1bnZwYW5o"
              target="_blank"
              rel="noopener noreferrer"
              aria-label="Instagram"
              class="w-5 h-5 sm:w-6 sm:h-6 rounded-full border border-zinc-500 flex items-center justify-center hover:bg-white hover:text-zinc-900 transition-colors"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                <rect x="4" y="4" width="16" height="16" rx="5" ry="5" />
                <circle cx="12" cy="12" r="3.2" />
                <circle cx="17" cy="7" r="0.8" fill="currentColor" />
              </svg>
            </a>
          </div>
        </div>
      </div>

      {/* HEADER PRINCIPAL */}
      <header class="border-b border-zinc-200 bg-white/95 backdrop-blur-sm shadow-sm">
        <div class="max-w-7xl mx-auto px-3 sm:px-4 md:px-6">

          {/* Fila principal: Logo + Buscador + Acciones */}
          <div class="py-3 sm:py-4 flex items-center gap-3 sm:gap-4 md:gap-6">

            {/* Logo */}
            <a href="/" class="flex items-center flex-shrink-0">
              <img
                src="/Logo/Logo2.png"
                alt="Logo"
                class="h-12 sm:h-14 md:h-16 lg:h-20 w-auto object-contain"
              />
            </a>

            {/* Espaciador flexible */}
            <div class="flex-1 min-w-0"></div>

            {/* Buscador (desktop y tablet) */}
            <div class="hidden sm:flex flex-1 items-center gap-2 sm:gap-3 max-w-xl lg:max-w-2xl">
              <div class="flex-1 flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-full border border-zinc-200 bg-white hover:border-zinc-300 hover:shadow-sm transition-all">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  class="w-5 h-5 sm:w-6 sm:h-6 lg:w-7 lg:h-7 text-white bg-black p-1 rounded flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="11" cy="11" r="6" />
                  <line x1="16" y1="16" x2="21" y2="21" />
                </svg>
                <input
                  type="text"
                  id="search-input-desktop"
                  name="search-desktop"
                  placeholder="Buscar productos..."
                  class="flex-1 text-xs sm:text-sm bg-transparent focus:outline-none min-w-0 search-input"
                  aria-label="Buscar productos"
                />
              </div>
            </div>

            {/* Botones derecha */}
            <div class="flex items-center gap-2 sm:gap-3 md:gap-4">

              {/* Lupa mobile */}
              <button
                id="search-toggle"
                data-open-search
                class="sm:hidden hover:text-pink-700 transition-colors p-1"
                aria-label="Buscar"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="11" cy="11" r="6" />
                  <line x1="16" y1="16" x2="21" y2="21" />
                </svg>
              </button>

              {/* Hamburguesa mobile */}
              <button
                id="menu-toggle"
                class="lg:hidden p-1"
                aria-label="Abrir menú"
              >
                <svg
                  id="menu-icon"
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6 transition-transform"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="1.8"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
              </button>
            </div>
          </div>

          {/* Navegación desktop */}
          <nav class="hidden lg:block border-t border-zinc-100">
            <div class="flex items-center justify-center gap-6 xl:gap-8 py-3 text-[11px] xl:text-[12px] uppercase tracking-[0.18em] xl:tracking-[0.22em] text-zinc-800 font-medium">

              <a href="../" class:list={[
                  "pb-1 border-b-2 transition-all whitespace-nowrap",
                  isActive('/') ? "border-pink-700" : "border-transparent hover:border-zinc-900"
                ]}>
                Inicio
              </a>

              <a 
                href="../sobre_nosotros" 
                class:list={[
                  "pb-1 border-b-2 transition-all whitespace-nowrap",
                  isActive('/sobre_nosotros') ? "border-pink-700" : "border-transparent hover:border-zinc-900"
                ]}
              >
                Sobre nosotros
              </a>

              <div class="relative group">
                <a 
                  href="/products" 
                  class:list={[
                    "inline-flex items-center gap-1 pb-1 border-b-2 transition-all whitespace-nowrap",
                    isActive('/products') ? "border-pink-700" : "border-transparent group-hover:border-zinc-900"
                  ]}
                >
                  <span>Productos</span>
                  <span class="text-[9px] translate-y-[1px] transition-transform group-hover:rotate-180">▾</span>
                </a>
                <!-- resto del dropdown -->
                  <div class="absolute left-0 top-full pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                    <div class="bg-white rounded-lg shadow-xl border border-zinc-200 py-2 min-w-[200px]">
                      <a href="/products/antiedad" class="block px-4 py-2 text-xs hover:bg-pink-50 hover:text-pink-700 transition-colors">Antiedad</a>
                      <a href="/products/acne" class="block px-4 py-2 text-xs hover:bg-pink-50 hover:text-pink-700 transition-colors">Acné</a>
                      <a href="/products/hiperpigmentacion" class="block px-4 py-2 text-xs hover:bg-pink-50 hover:text-pink-700 transition-colors">Hiperpigmentación</a>
                      <a href="/products/proteccion-solar" class="block px-4 py-2 text-xs hover:bg-pink-50 hover:text-pink-700 transition-colors">Protección Solar</a>
                      <a href="/products/hidratantes" class="block px-4 py-2 text-xs hover:bg-pink-50 hover:text-pink-700 transition-colors">Hidratantes</a>
                      <a href="/products/limpiadores" class="block px-4 py-2 text-xs hover:bg-pink-50 hover:text-pink-700 transition-colors">Limpiadores</a>
                      <a href="/products/otros" class="block px-4 py-2 text-xs hover:bg-pink-50 hover:text-pink-700 transition-colors">Otros</a>
                      <a href="/products/all" class="block px-4 py-2 text-xs hover:bg-pink-50 hover:text-pink-700 transition-colors border-t border-zinc-100 mt-1 pt-2">Ver Todo</a>
                    </div>
                  </div>
              </div>

              <a 
                href="/kits" 
                class:list={[
                  "pb-1 border-b-2 transition-all whitespace-nowrap",
                  isActive('/kits') ? "border-pink-700" : "border-transparent hover:border-zinc-900"
                ]}
              >
                Kits
              </a>

              <a 
                href="/antes_despues" 
                class:list={[
                  "pb-1 border-b-2 transition-all whitespace-nowrap",
                  isActive('/antes_despues') ? "border-pink-700" : "border-transparent hover:border-zinc-900"
                ]}
              >
                Antes y Después
              </a>

              <a 
                href="/blog" 
                class:list={[
                  "pb-1 border-b-2 transition-all whitespace-nowrap",
                  isActive('/blog') ? "border-pink-700" : "border-transparent hover:border-zinc-900"
                ]}
              >
                Blog
              </a>

              <a 
                href="/contacto" 
                class:list={[
                  "pb-1 border-b-2 transition-all whitespace-nowrap",
                  isActive('/contacto') ? "border-pink-700" : "border-transparent hover:border-zinc-900"
                ]}
              >
                Contáctanos
              </a>
            </div>
          </nav>
        </div>
      </header>
    </div>

    {/* CONTENIDO PRINCIPAL */}
    <main class="flex-1">
      <slot />
    </main>

    {/* MENÚ MOBILE/TABLET */}
    <div
      id="mobile-menu"
      class="lg:hidden fixed inset-y-0 right-0 w-full sm:w-80 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 overflow-y-auto z-[9999]"
    >
      <div class="flex flex-col h-full min-h-screen">

        <div class="flex items-center justify-between p-4 sm:p-6 border-b border-zinc-200 bg-white">
          <div class="flex items-center gap-3">
            <img src="/Logo/Logo2.png" alt="Logo" class="h-10 sm:h-12 w-auto object-contain" />
          </div>
          <button id="close-menu" class="p-2 hover:bg-zinc-100 rounded-full transition-colors" aria-label="Cerrar menú">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <nav class="flex-1 overflow-y-auto p-4 sm:p-6 space-y-1">
          <a 
            href="/" 
            class:list={[
              "block px-4 py-3 rounded-lg transition-colors font-medium text-base",
              isActive('/') ? "bg-pink-50 text-pink-700" : "hover:bg-zinc-50 hover:text-pink-700"
            ]}
          >
            Inicio
          </a>

          <a 
            href="/sobre_nosotros" 
            class:list={[
              "block px-4 py-3 rounded-lg transition-colors font-medium text-base",
              isActive('/sobre_nosotros') ? "bg-pink-50 text-pink-700" : "hover:bg-zinc-50 hover:text-pink-700"
            ]}
          >
            Sobre nosotros
          </a>

          <div>
            <button
              id="mobile-products-toggle"
              type="button"
              class="w-full flex items-center justify-between px-4 py-3 rounded-lg transition-colors font-medium text-base text-left"
            >
              <span>Productos</span>
              <svg id="products-arrow" class="w-5 h-5 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>

            <div id="mobile-products-submenu" class="hidden pl-4 mt-1 space-y-1 bg-zinc-50/50 rounded-lg py-2">
              <a href="/products/antiedad" class="block px-4 py-2.5 text-sm rounded-lg hover:bg-white hover:text-pink-700 transition-colors">Antiedad</a>
              <a href="/products/acne" class="block px-4 py-2.5 text-sm rounded-lg hover:bg-white hover:text-pink-700 transition-colors">Acné</a>
              <a href="/products/hiperpigmentacion" class="block px-4 py-2.5 text-sm rounded-lg hover:bg-white hover:text-pink-700 transition-colors">Hiperpigmentación</a>
              <a href="/products/proteccion-solar" class="block px-4 py-2.5 text-sm rounded-lg hover:bg-white hover:text-pink-700 transition-colors">Protección Solar</a>
              <a href="/products/hidratantes" class="block px-4 py-2.5 text-sm rounded-lg hover:bg-white hover:text-pink-700 transition-colors">Hidratantes</a>
              <a href="/products/limpiadores" class="block px-4 py-2.5 text-sm rounded-lg hover:bg-white hover:text-pink-700 transition-colors">Limpiadores</a>
              <a href="/products/otros" class="block px-4 py-2.5 text-sm rounded-lg hover:bg-white hover:text-pink-700 transition-colors">Otros</a>
              <a href="/products/all" class="block px-4 py-2.5 text-sm rounded-lg hover:bg-white hover:text-pink-700 transition-colors">Ver Todo</a>
            </div>
          </div>

          <a 
            href="/kits"
            class:list={[
              "block px-4 py-3 rounded-lg font-medium text-base transition-colors",
              isActive('/kits') ? "bg-pink-50 text-pink-700" : "hover:bg-zinc-50 hover:text-pink-700"
            ]}
          >
            Kits
          </a>

          <a 
            href="/antes_despues"
            class:list={[
              "block px-4 py-3 rounded-lg font-medium text-base transition-colors",
              isActive('/antes_despues') ? "bg-pink-50 text-pink-700" : "hover:bg-zinc-50 hover:text-pink-700"
            ]}
          >
            Antes y Después
          </a>

          <a 
            href="/blog"
            class:list={[
              "block px-4 py-3 rounded-lg font-medium text-base transition-colors",
              isActive('/blog') ? "bg-pink-50 text-pink-700" : "hover:bg-zinc-50 hover:text-pink-700"
            ]}
          >
            Blog
          </a>

          <a 
            href="/contacto"
            class="block px-4 py-3 rounded-lg font-medium text-base transition-colors hover:bg-zinc-50 hover:text-pink-700 border-t border-zinc-200 mt-4 pt-4"
          >
            Contáctanos
          </a>
        </nav>
      </div>
    </div>

    <div id="menu-overlay" class="lg:hidden fixed inset-0 bg-black/50 opacity-0 pointer-events-none transition-opacity duration-300 z-[9998]"></div>

    {/* OVERLAY DE BÚSQUEDA */}
    <div id="search-overlay" class="fixed inset-0 bg-black/50 z-[60] hidden items-start justify-center pt-16 sm:pt-20 px-4">
      <div class="w-full max-w-4xl bg-white rounded-2xl sm:rounded-3xl shadow-2xl border border-zinc-200 overflow-hidden animate-slide-down">

        <div class="px-4 sm:px-6 py-3 sm:py-4 border-b border-zinc-100 flex items-center gap-2 sm:gap-4">
          <div class="flex-1 flex items-center gap-2 sm:gap-3">
            <input
              type="text"
              id="search-input-overlay"
              name="search-overlay"
              placeholder="Buscar productos..."
              class="w-full text-sm sm:text-base px-3 sm:px-4 py-2 rounded-full border border-zinc-200 focus:outline-none focus:border-pink-400 focus:ring-2 focus:ring-pink-100 transition-all search-input"
              aria-label="Buscar productos"
            />
            <button
              type="button"
              id="overlay-search-btn"
              class="h-8 w-8 sm:h-9 sm:w-9 rounded-full bg-zinc-900 text-white flex items-center justify-center hover:bg-pink-700 transition-colors flex-shrink-0"
              aria-label="Buscar"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="6" />
                <line x1="16" y1="16" x2="21" y2="21" />
              </svg>
            </button>
          </div>

          <button type="button" id="close-search" class="text-xl sm:text-2xl text-zinc-400 hover:text-zinc-700 transition-colors p-1" aria-label="Cerrar búsqueda">
            ✕
          </button>
        </div>

        <div class="px-4 sm:px-6 py-4 space-y-3">
          <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wide">Búsqueda popular</p>
          <div class="flex flex-wrap gap-2 text-xs sm:text-sm">
            <button class="search-tag px-3 py-1.5 rounded-full bg-zinc-100 hover:bg-pink-50 hover:text-pink-700 transition-colors">acné</button>
            <button class="search-tag px-3 py-1.5 rounded-full bg-zinc-100 hover:bg-pink-50 hover:text-pink-700 transition-colors">antiedad</button>
            <button class="search-tag px-3 py-1.5 rounded-full bg-zinc-100 hover:bg-pink-50 hover:text-pink-700 transition-colors">hiperpigmentación</button>
            <button class="search-tag px-3 py-1.5 rounded-full bg-zinc-100 hover:bg-pink-50 hover:text-pink-700 transition-colors">protección solar</button>
            <button class="search-tag px-3 py-1.5 rounded-full bg-zinc-100 hover:bg-pink-50 hover:text-pink-700 transition-colors">hidratantes</button>
            <button class="search-tag px-3 py-1.5 rounded-full bg-zinc-100 hover:bg-pink-50 hover:text-pink-700 transition-colors">limpiador</button>
          </div>
        </div>

        <div id="resultados-busqueda" class="hidden"></div>
      </div>
    </div>

    <style>
      @keyframes slide-down {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-slide-down { animation: slide-down 0.3s ease-out; }
      body.menu-open { overflow: hidden; }
    </style>

    <script define:vars={{ productos: productosData }}>
      document.addEventListener('DOMContentLoaded', function() {

        const todosLosProductos = productos;

        function irAResultados(termino) {
          const q = termino.toLowerCase().trim();
          if (!q || q.length < 2) return;
          window.location.href = `/products/all?search=${encodeURIComponent(q)}`;
        }

        function realizarBusqueda(termino) {
          if (!termino || termino.trim().length < 2) return [];

          const terminoLower = termino.toLowerCase().trim();

          return todosLosProductos.filter(producto => {
            const nombreCoincide = (producto.name || "").toLowerCase().includes(terminoLower);

            const cat = producto.category;
            const categoriaCoincide = Array.isArray(cat)
              ? cat.some(c => (c || "").toLowerCase().includes(terminoLower))
              : (cat || "").toLowerCase().includes(terminoLower);

            const descripcionCoincide = (producto.description || "").toLowerCase().includes(terminoLower);

            return nombreCoincide || categoriaCoincide || descripcionCoincide;
          });
        }

        function mostrarResultados(resultados, termino) {
          const resultadosContainer = document.getElementById("resultados-busqueda");
          if (!resultadosContainer) return;

          resultadosContainer.classList.remove("hidden");
          resultadosContainer.className = "px-4 sm:px-6 py-4 max-h-96 overflow-y-auto border-t border-zinc-100";

          if (termino.length < 2) {
            resultadosContainer.classList.add("hidden");
            return;
          }

          if (resultados.length === 0) {
            resultadosContainer.innerHTML = `
              <div class="text-center py-8 text-zinc-500">
                <svg class="w-12 h-12 mx-auto mb-3 opacity-30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <circle cx="11" cy="11" r="6" stroke-width="2"/>
                  <line x1="16" y1="16" x2="21" y2="21" stroke-width="2"/>
                </svg>
                <p class="text-sm">No se encontraron resultados para "<strong>${termino}</strong>"</p>
                <p class="text-xs mt-2">Intenta con otros términos de búsqueda</p>
              </div>
            `;
            return;
          }

          resultadosContainer.innerHTML = `
            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wide mb-3">
              ${resultados.length} resultado${resultados.length !== 1 ? 's' : ''}
            </p>
            <div class="space-y-2">
              ${resultados.map(producto => `
                <a href="${producto.url || '/product/' + producto.id}" 
                   class="block px-4 py-3 rounded-lg hover:bg-zinc-50 transition-colors group">
                  <div class="flex gap-3 items-center">
                    ${producto.image ? `
                      <img src="${producto.image}" alt="${producto.name}" class="w-12 h-12 object-cover rounded-lg flex-shrink-0">
                    ` : `
                      <div class="w-12 h-12 bg-zinc-200 rounded-lg flex items-center justify-center flex-shrink-0">
                        <svg class="w-6 h-6 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                      </div>
                    `}
                    <div class="flex-1 min-w-0">
                      <p class="font-medium text-sm group-hover:text-pink-700 truncate">${producto.name}</p>
                      ${producto.category ? `
                        <p class="text-xs text-zinc-500 capitalize">${
                          Array.isArray(producto.category)
                            ? producto.category.join(", ").replace(/-/g, " ")
                            : producto.category.replace(/-/g, ' ')
                        }</p>
                      ` : ''}
                    </div>
                  </div>
                </a>
              `).join('')}
            </div>
          `;
        }

        const searchInputs = document.querySelectorAll('.search-input');

        searchInputs.forEach((input) => {

          input.addEventListener('input', (e) => {
            const termino = e.target.value.trim();
            const resultados = realizarBusqueda(termino);
            mostrarResultados(resultados, termino);

            searchInputs.forEach(otherInput => {
              if (otherInput !== input) otherInput.value = e.target.value;
            });
          });

          input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
              e.preventDefault();
              const termino = e.target.value.trim();
              irAResultados(termino);
            }
          });
        });

        const overlaySearchBtn = document.getElementById("overlay-search-btn");
        overlaySearchBtn?.addEventListener("click", () => {
          const anyInput = document.querySelector(".search-input");
          const termino = anyInput?.value || "";
          irAResultados(termino);
        });

        const searchTags = document.querySelectorAll('.search-tag');
        searchTags.forEach(tag => {
          tag.addEventListener('click', () => {
            const termino = tag.textContent.trim();
            const input = document.querySelector('#search-input-overlay');

            if (input) {
              input.value = termino;
              const resultados = realizarBusqueda(termino);
              mostrarResultados(resultados, termino);
              input.focus();
            }
          });
        });

        // ---- MENÚ HAMBURGUESA ----
        const menuBtn = document.getElementById("menu-toggle");
        const mobileMenu = document.getElementById("mobile-menu");
        const menuOverlay = document.getElementById("menu-overlay");
        const closeMenuBtn = document.getElementById("close-menu");
        const menuIcon = document.getElementById("menu-icon");

        function openMenu() {
          if (mobileMenu && menuOverlay) {
            mobileMenu.classList.remove("translate-x-full");
            mobileMenu.classList.add("translate-x-0");
            menuOverlay.classList.remove("opacity-0", "pointer-events-none");
            menuOverlay.classList.add("opacity-100");
            document.body.classList.add("menu-open");

            if (menuIcon) {
              menuIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />`;
            }
          }
        }

        function closeMenu() {
          if (mobileMenu && menuOverlay) {
            mobileMenu.classList.add("translate-x-full");
            mobileMenu.classList.remove("translate-x-0");
            menuOverlay.classList.add("opacity-0", "pointer-events-none");
            menuOverlay.classList.remove("opacity-100");
            document.body.classList.remove("menu-open");

            if (menuIcon) {
              menuIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />`;
            }
          }
        }

        menuBtn?.addEventListener("click", () => {
          if (mobileMenu?.classList.contains("translate-x-full")) openMenu();
          else closeMenu();
        });

        closeMenuBtn?.addEventListener("click", closeMenu);
        menuOverlay?.addEventListener("click", closeMenu);

        // ---- SUBMENU PRODUCTOS MOBILE ----
        const productsToggle = document.getElementById("mobile-products-toggle");
        const productsSubmenu = document.getElementById("mobile-products-submenu");
        const productsArrow = document.getElementById("products-arrow");

        productsToggle?.addEventListener("click", (e) => {
          e.preventDefault();
          e.stopPropagation();

          const isHidden = productsSubmenu?.classList.contains("hidden");

          if (isHidden) {
            productsSubmenu?.classList.remove("hidden");
            productsArrow?.classList.add("rotate-180");
          } else {
            productsSubmenu?.classList.add("hidden");
            productsArrow?.classList.remove("rotate-180");
          }
        });

        // ---- BUSCADOR OVERLAY ----
        const searchOverlay = document.getElementById("search-overlay");
        const closeSearchBtn = document.getElementById("close-search");
        const openSearchButtons = document.querySelectorAll("[data-open-search]");

        function openSearch() {
          if (searchOverlay) {
            searchOverlay.classList.remove("hidden");
            searchOverlay.classList.add("flex");
            document.body.classList.add("menu-open");

            setTimeout(() => {
              const input = document.querySelector("#search-input-overlay");
              input?.focus();
            }, 100);
          }
        }

        function closeSearch() {
          if (searchOverlay) {
            searchOverlay.classList.add("hidden");
            searchOverlay.classList.remove("flex");
            document.body.classList.remove("menu-open");

            const resultadosContainer = document.getElementById("resultados-busqueda");
            if (resultadosContainer) resultadosContainer.classList.add("hidden");
          }
        }

        openSearchButtons.forEach((btn) => btn.addEventListener("click", openSearch));
        closeSearchBtn?.addEventListener("click", closeSearch);

        searchOverlay?.addEventListener("click", (e) => {
          if (e.target === searchOverlay) closeSearch();
        });

        window.addEventListener("keydown", (e) => {
          if (e.key === "Escape") {
            closeSearch();
            closeMenu();
          }
        });

        // ---- STICKY HEADER EFFECT ----
        const header = document.querySelector("header");
        window.addEventListener("scroll", () => {
          const currentScroll = window.pageYOffset;
          if (currentScroll <= 0) header?.classList.remove("shadow-md");
          else header?.classList.add("shadow-md");
        });
      });
    </script>
  </body>
</html>
